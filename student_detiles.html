<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Details Viewer - Alif Edu</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 0;
    }
    .topbar {
      background-color: navy;
      color: goldenrod;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .topbar img {
      height: 40px;
    }
    .container {
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: goldenrod;
      color: white;
    }
    .footer {
      text-align: center;
      padding: 10px;
      background: navy;
      color: goldenrod;
    }
    .button {
      background: goldenrod;
      border: none;
      color: white;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 5px;
    }
    #individualView {
      display: none;
      background: white;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    #studentPhoto {
      max-width: 150px;
      border: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <div class="topbar">
    <img src="1.png" alt="Alif Edu Logo">
    <button class="button" onclick="goBack()">Dashboard</button>
  </div>

  <div class="container">
    <h2>All Students</h2>
    <table id="studentTable">
      <thead>
        <tr id="tableHeader"></tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>

    <div id="individualView">
      <h3>Student Details</h3>
      <img id="studentPhoto" src="" alt="Student Photo">
      <div id="studentInfo"></div>
      <br>
      <button class="button" onclick="downloadStudentData()">Download</button>
      <button class="button" onclick="closeIndividualView()">Close</button>
    </div>
  </div>

  <div class="footer">
    &copy; ALIF EDU. All rights reserved.
  </div>

  <script>
    const sheetURL = 'https://script.google.com/macros/s/AKfycbycmQxO8mPgxXoaGBFvpybamBhxC8JF3UGyEZvlFSm-1Arw4xPZJhjQ9HUX2NvUFR5s0Q/exec'; // Replace with your Apps Script Web App URL
    let studentData = [];
    let selectedStudent = null;

    fetch(sheetURL)
      .then(res => res.json())
      .then(data => {
        studentData = data;
        renderTable(data);
      });

    function renderTable(data) {
      const headerRow = document.getElementById('tableHeader');
      const body = document.getElementById('tableBody');

      if (data.length === 0) return;

      const keys = Object.keys(data[0]).filter(k => k !== 'HELPER');
      headerRow.innerHTML = keys.map(k => `<th>${k}</th>`).join('') + '<th>Action</th>';

      body.innerHTML = data.map((row, i) => {
        const rowData = keys.map(k => `<td>${k === 'Photo' ? `<img src="${row[k]}" width="50">` : row[k]}</td>`).join('');
        return `<tr>${rowData}<td><button class='button' onclick='viewStudent(${i})'>View</button></td></tr>`;
      }).join('');
    }

    function viewStudent(index) {
      selectedStudent = studentData[index];
      const infoDiv = document.getElementById('studentInfo');
      const photo = document.getElementById('studentPhoto');
      photo.src = selectedStudent['Photo'];

      infoDiv.innerHTML = Object.entries(selectedStudent)
        .filter(([k]) => k !== 'Photo' && k !== 'HELPER')
        .map(([k, v]) => `<p><strong>${k}</strong>: ${v}</p>`).join('');

      document.getElementById('individualView').style.display = 'block';
    }

    function closeIndividualView() {
      document.getElementById('individualView').style.display = 'none';
    }

    function downloadStudentData() {
      if (!selectedStudent) return;
      const content = Object.entries(selectedStudent)
        .filter(([k]) => k !== 'Photo' && k !== 'HELPER')
        .map(([k, v]) => `${k}: ${v}`).join('\n');

      const blob = new Blob([content], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `${selectedStudent['Student Full Name']}.txt`;
      a.click();
    }

    function goBack() {
      window.history.back();
    }
  </script>
</body>
</html>
