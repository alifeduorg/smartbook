<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Student Progress Card</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f7fa;
    padding: 20px;
    color: #333;
  }
  h1 {
    text-align: center;
    margin-bottom: 30px;
    color: #004080;
  }
  form {
    max-width: 700px;
    margin: 0 auto;
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 4px 14px rgb(0 64 128 / 0.15);
  }
  label {
    display: block;
    margin-top: 15px;
    font-weight: 600;
  }
  input[type=text],
  input[type=number],
  select {
    width: 100%;
    padding: 8px 10px;
    margin-top: 6px;
    border: 1.8px solid #ccc;
    border-radius: 5px;
    font-size: 1rem;
    transition: border-color 0.3s;
  }
  input[type=text]:focus,
  input[type=number]:focus,
  select:focus {
    border-color: #004080;
    outline: none;
  }
  .subjects {
    margin-top: 20px;
  }
  .subject-row {
    display: flex;
    gap: 15px;
    margin-bottom: 12px;
    align-items: center;
  }
  .subject-row input[type=text],
  .subject-row input[type=number] {
    flex: 1;
  }
  .subject-row button.remove-subject {
    background: #e74c3c;
    border: none;
    color: white;
    padding: 6px 10px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .subject-row button.remove-subject:hover {
    background: #c0392b;
  }
  button#addSubjectBtn {
    background: #004080;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 10px;
    font-weight: 600;
  }
  button#addSubjectBtn:hover {
    background: #003366;
  }
  button[type=submit] {
    background: #008080;
    color: white;
    border: none;
    padding: 12px 20px;
    font-size: 1.1rem;
    border-radius: 7px;
    cursor: pointer;
    margin-top: 25px;
    width: 100%;
    font-weight: 700;
  }
  button[type=submit]:hover {
    background: #006666;
  }
  .message {
    margin-top: 20px;
    text-align: center;
    font-weight: 600;
  }
  .message.error {
    color: #e74c3c;
  }
  .message.success {
    color: #27ae60;
  }
</style>
</head>
<body>
  <h1>Student Progress Card</h1>
  <form id="progressForm">
    <label for="studentName">Student Name *</label>
    <input type="text" id="studentName" name="studentName" required />

    <label for="studentId">Student ID *</label>
    <input type="text" id="studentId" name="studentId" required />

    <label for="className">Class *</label>
    <input type="text" id="className" name="className" required />

    <label for="examType">Exam Type *</label>
    <select id="examType" name="examType" required>
      <option value="">Select Exam Type</option>
      <option>Academic Test 1</option>
      <option>Academic Test 2</option>
      <option>Academic Test 3</option>
      <option>Academic Test 4</option>
      <option>Periodic Test 1</option>
      <option>Periodic Test 2</option>
      <option>Periodic Test 3</option>
      <option>Periodic Test 4</option>
      <option>Term 1</option>
      <option>Term 2</option>
      <option>Model Exam</option>
      <option>Admission Test</option>
      <option>Revision Test Series</option>
    </select>

    <div class="subjects" id="subjectsContainer">
      <h3>Subjects</h3>
      <!-- Subject rows inserted here -->
    </div>
    <button type="button" id="addSubjectBtn">+ Add Subject</button>

    <button type="submit">Submit Progress Card</button>
    <div id="message" class="message"></div>
  </form>

<script>
  const subjectsContainer = document.getElementById('subjectsContainer');
  const addSubjectBtn = document.getElementById('addSubjectBtn');
  const form = document.getElementById('progressForm');
  const messageDiv = document.getElementById('message');

  // Create a new subject input row
  function createSubjectRow(subject = '', obtainedMarks = '', maxMarks = '') {
    const row = document.createElement('div');
    row.className = 'subject-row';

    row.innerHTML = `
      <input type="text" name="subjectName" placeholder="Subject Name *" value="${subject}" required />
      <input type="number" name="obtainedMarks" placeholder="Marks Obtained *" min="0" value="${obtainedMarks}" required />
      <input type="number" name="maxMarks" placeholder="Marks Out Of *" min="1" value="${maxMarks}" required />
      <button type="button" class="remove-subject" title="Remove Subject">&times;</button>
    `;

    // Remove subject button handler
    row.querySelector('.remove-subject').addEventListener('click', () => {
      subjectsContainer.removeChild(row);
    });

    return row;
  }

  // Add initial subject row on page load
  subjectsContainer.appendChild(createSubjectRow());

  addSubjectBtn.addEventListener('click', () => {
    subjectsContainer.appendChild(createSubjectRow());
  });

  // Calculate percentage and grade
  function calculateGrade(percentage) {
    if (percentage >= 90) return 'A+';
    if (percentage >= 80) return 'A';
    if (percentage >= 70) return 'B+';
    if (percentage >= 60) return 'B';
    if (percentage >= 50) return 'C';
    if (percentage >= 40) return 'D';
    return 'F';
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    messageDiv.textContent = '';
    messageDiv.className = 'message';

    // Validate form fields (HTML5 validation covers required fields)
    if (!form.checkValidity()) {
      messageDiv.textContent = 'Please fill all required fields correctly.';
      messageDiv.classList.add('error');
      return;
    }

    // Collect form data
    const studentName = form.studentName.value.trim();
    const studentId = form.studentId.value.trim();
    const className = form.className.value.trim();
    const examType = form.examType.value;

    // Collect subjects
    const subjectRows = subjectsContainer.querySelectorAll('.subject-row');
    const subjects = [];
    for (const row of subjectRows) {
      const subjectName = row.querySelector('input[name="subjectName"]').value.trim();
      const obtainedMarks = parseFloat(row.querySelector('input[name="obtainedMarks"]').value);
      const maxMarks = parseFloat(row.querySelector('input[name="maxMarks"]').value);

      if (!subjectName || isNaN(obtainedMarks) || isNaN(maxMarks) || obtainedMarks < 0 || maxMarks <= 0 || obtainedMarks > maxMarks) {
        messageDiv.textContent = 'Please enter valid subject marks and names.';
        messageDiv.classList.add('error');
        return;
      }

      const percentage = ((obtainedMarks / maxMarks) * 100).toFixed(2);
      const grade = calculateGrade(percentage);

      subjects.push({
        subjectName,
        obtainedMarks,
        maxMarks,
        percentage,
        grade
      });
    }

    if (subjects.length === 0) {
      messageDiv.textContent = 'Add at least one subject.';
      messageDiv.classList.add('error');
      return;
    }

    // Prepare data to send
    const data = {
      studentName,
      studentId,
      className,
      examType,
      subjects
    };

    try {
      messageDiv.textContent = 'Submitting...';
      messageDiv.classList.remove('error');
      messageDiv.classList.remove('success');

      // Replace YOUR_SCRIPT_URL_HERE with your Apps Script URL
      const response = await fetch('https://script.google.com/macros/s/AKfycbyh2RV6dPgvToAzRI4_KWmKrkpXPf9ToJQqrQAfoR1JMFue_IB-Y_nd1B5hIvWOF5Cj/exec', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

      const result = await response.json();

      if (result.success) {
        messageDiv.textContent = 'Progress card submitted successfully!';
        messageDiv.classList.add('success');
        form.reset();
        // Reset to one subject row only
        subjectsContainer.innerHTML = '';
        subjectsContainer.appendChild(createSubjectRow());
      } else {
        throw new Error(result.error || 'Unknown server error');
      }
    } catch (error) {
      messageDiv.textContent = `Error submitting data: ${error.message}`;
      messageDiv.classList.add('error');
    }
  });
</script>
</body>
</html>
