<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Progress Report</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f7f9;
      padding: 20px;
    }
    .container {
      background: #fff;
      max-width: 800px;
      margin: auto;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0px 0px 10px #ccc;
    }
    h2 {
      text-align: center;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    .subject-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .subject-row input {
      flex: 1;
    }
    .subject-row button {
      background: red;
      color: white;
      border: none;
      padding: 6px 10px;
      cursor: pointer;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      margin-top: 20px;
    }
    .success, .error {
      margin-top: 15px;
      padding: 10px;
      text-align: center;
      border-radius: 5px;
    }
    .success {
      background-color: #d4edda;
      color: #155724;
    }
    .error {
      background-color: #f8d7da;
      color: #721c24;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Student Progress Report</h2>
    <form id="progressForm">
      <label>Student Name *</label>
      <input type="text" name="studentName" required>

      <label>Student ID *</label>
      <input type="text" name="studentID" required>

      <label>Class *</label>
      <input type="text" name="class" required>

      <label>Exam Type *</label>
      <select name="examType" required>
        <option value="">--Select--</option>
        <option value="Academic Test 1">Academic Test 1</option>
        <option value="Academic Test 2">Academic Test 2</option>
        <option value="Academic Test 3">Academic Test 3</option>
        <option value="Academic Test 4">Academic Test 4</option>
        <option value="Periodic Test 1">Periodic Test 1</option>
        <option value="Periodic Test 2">Periodic Test 2</option>
        <option value="Periodic Test 3">Periodic Test 3</option>
        <option value="Periodic Test 4">Periodic Test 4</option>
        <option value="Term 1">Term 1</option>
        <option value="Term 2">Term 2</option>
        <option value="Model Exam">Model Exam</option>
        <option value="Admission Test">Admission Test</option>
        <option value="Revision Test Series">Revision Test Series</option>
      </select>

      <h3>Subjects</h3>
      <div id="subjects"></div>
      <button type="button" onclick="addSubject()">Add Subject</button>

      <button type="submit">Submit</button>
      <div id="responseMessage"></div>
    </form>
  </div>

  <script>
    const form = document.getElementById("progressForm");
    const subjectsDiv = document.getElementById("subjects");
    const responseDiv = document.getElementById("responseMessage");

    function addSubject() {
      const row = document.createElement("div");
      row.className = "subject-row";
      row.innerHTML = `
        <input type="text" placeholder="Subject Name" required>
        <input type="number" placeholder="Marks Obtained" min="0" required>
        <input type="number" placeholder="Marks Out Of" min="1" required>
        <button type="button" onclick="this.parentElement.remove()">X</button>
      `;
      subjectsDiv.appendChild(row);
    }

    form.addEventListener("submit", async function (e) {
      e.preventDefault();
      responseDiv.innerHTML = '';

      const studentName = form.studentName.value.trim();
      const studentID = form.studentID.value.trim();
      const className = form.class.value.trim();
      const examType = form.examType.value;

      if (!studentName || !studentID || !className || !examType || subjectsDiv.children.length === 0) {
        showError("Please fill all required fields and add at least one subject.");
        return;
      }

      const subjects = [];
      let valid = true;
      document.querySelectorAll(".subject-row").forEach(row => {
        const inputs = row.querySelectorAll("input");
        const [subjectName, marksObtained, marksOutOf] = Array.from(inputs).map(i => i.value.trim());
        if (!subjectName || !marksObtained || !marksOutOf) {
          valid = false;
          return;
        }
        const percentage = ((marksObtained / marksOutOf) * 100).toFixed(2);
        const grade = getGrade(percentage);
        subjects.push({
          subjectName, marksObtained, marksOutOf, percentage, grade
        });
      });

      if (!valid) {
        showError("Please complete all subject fields.");
        return;
      }

      const payload = {
        studentName,
        studentID,
        class: className,
        examType,
        subjects
      };

      try {
        const res = await fetch("https://script.google.com/macros/s/AKfycbyh2RV6dPgvToAzRI4_KWmKrkpXPf9ToJQqrQAfoR1JMFue_IB-Y_nd1B5hIvWOF5Cj/exec", {
          method: "POST",
          mode: "no-cors", // Use "cors" if Apps Script supports CORS headers
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });
        showSuccess("Form submitted successfully.");
        form.reset();
        subjectsDiv.innerHTML = '';
      } catch (err) {
        showError("Submission failed. Try again.");
      }
    });

    function getGrade(percentage) {
      percentage = parseFloat(percentage);
      if (percentage >= 90) return "A+";
      if (percentage >= 80) return "A";
      if (percentage >= 70) return "B+";
      if (percentage >= 60) return "B";
      if (percentage >= 50) return "C";
      return "F";
    }

    function showSuccess(msg) {
      responseDiv.innerHTML = `<div class="success">${msg}</div>`;
    }

    function showError(msg) {
      responseDiv.innerHTML = `<div class="error">${msg}</div>`;
    }

    // Initial subject row
    addSubject();
  </script>
</body>
</html>
