<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Log Filter</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    select, input, button {
      margin: 10px;
      padding: 6px;
    }
    table, th, td {
      border: 1px solid #ccc;
      border-collapse: collapse;
      padding: 5px;
    }
  </style>
</head>
<body>

  <h2>Student Log Filter</h2>

  <!-- Filters -->
  <label for="studentSelect">Select Student:</label>
  <select id="studentSelect">
    <option value="">-- Select Student --</option>
    <option value="S101">Amina (S101)</option>
    <option value="S102">Bilal (S102)</option>
    <option value="S103">Fatima (S103)</option>
  </select>

  <label for="startDate">Start Date:</label>
  <input type="date" id="startDate">

  <label for="endDate">End Date:</label>
  <input type="date" id="endDate">

  <button id="filterBtn">Filter</button>
  <button id="downloadBtn">Download PDF</button>

  <hr>

  <!-- Filtered Table -->
  <table id="studentTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Student ID</th>
        <th>Student Name</th>
        <th>Subject</th>
        <th>Teacher</th>
        <th>What Was Taught</th>
        <th>Homework</th>
      </tr>
    </thead>
    <tbody>
      <!-- Filtered entries will go here -->
    </tbody>
  </table>

  <script>
    // Mock logbook entries
    const logbookEntries = [
      { date: '2024-05-01', studentID: 'S101', studentName: 'Amina', subject: 'Math', teacher: 'Mr. Ali', taught: 'Addition', homework: 'Page 10' },
      { date: '2024-05-02', studentID: 'S102', studentName: 'Bilal', subject: 'Science', teacher: 'Ms. Sara', taught: 'Plants', homework: 'Draw diagram' },
      { date: '2024-05-03', studentID: 'S101', studentName: 'Amina', subject: 'English', teacher: 'Ms. Noor', taught: 'Grammar', homework: 'Exercise 2' },
      { date: '2024-05-04', studentID: 'S103', studentName: 'Fatima', subject: 'Math', teacher: 'Mr. Ali', taught: 'Subtraction', homework: 'Page 11' }
    ];

    const studentSelect = document.getElementById('studentSelect');
    const startInput = document.getElementById('startDate');
    const endInput = document.getElementById('endDate');
    const tableBody = document.querySelector('#studentTable tbody');

    let filtered = [];

    document.getElementById('filterBtn').addEventListener('click', () => {
      const selectedID = studentSelect.value;
      const startDate = new Date(startInput.value);
      const endDate = new Date(endInput.value);

      if (!selectedID || !startInput.value || !endInput.value) {
        alert('Please select student and date range.');
        return;
      }

      filtered = logbookEntries.filter(entry => {
        const entryDate = new Date(entry.date);
        return entry.studentID === selectedID && entryDate >= startDate && entryDate <= endDate;
      });

      tableBody.innerHTML = '';

      if (filtered.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="7">No data found.</td></tr>`;
      } else {
        filtered.forEach(entry => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${entry.date}</td>
            <td>${entry.studentID}</td>
            <td>${entry.studentName}</td>
            <td>${entry.subject}</td>
            <td>${entry.teacher}</td>
            <td>${entry.taught}</td>
            <td>${entry.homework}</td>
          `;
          tableBody.appendChild(row);
        });
      }
    });

    document.getElementById('downloadBtn').addEventListener('click', async () => {
      const jsPDF = window.jspdf.jsPDF;
      const doc = new jsPDF();

      if (filtered.length === 0) {
        alert("Please filter data first before downloading.");
        return;
      }

      doc.setFontSize(14);
      doc.text("Student Log Report", 10, 10);

      let y = 20;

      filtered.forEach((entry, index) => {
        doc.setFontSize(10);
        doc.text(`Date: ${entry.date}`, 10, y);
        doc.text(`Student ID: ${entry.studentID}`, 60, y);
        doc.text(`Name: ${entry.studentName}`, 120, y);
        y += 6;
        doc.text(`Subject: ${entry.subject}`, 10, y);
        doc.text(`Teacher: ${entry.teacher}`, 60, y);
        y += 6;
        doc.text(`Taught: ${entry.taught}`, 10, y);
        y += 6;
        doc.text(`Homework: ${entry.homework}`, 10, y);
        y += 10;

        // Check for page break
        if (y > 270 && index !== filtered.length - 1) {
          doc.addPage();
          y = 10;
        }
      });

      doc.save("Student_Log_Report.pdf");
    });
  </script>

</body>
</html>
