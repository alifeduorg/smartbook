<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fee Billing Panel</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #f9f9f9;
    }
    header {
      background: navy;
      color: goldenrod;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
    }
    .container {
      max-width: 800px;
      margin: 2rem auto;
      background: #fff;
      padding: 2rem;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      border-radius: 12px;
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: 600;
    }
    input, select, button, textarea {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.3rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background: goldenrod;
      color: navy;
      font-weight: bold;
      margin-top: 1.5rem;
      cursor: pointer;
    }
    .actions {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }
    .actions button {
      flex: 1;
    }
    footer {
      text-align: center;
      font-size: 0.9rem;
      padding: 1rem;
      color: gray;
    }
  </style>
</head>
<body>

<header>ALIF EDU - Fee Billing Panel</header>

<div class="container">
  <form id="billingForm">
    <label>Bill Date</label>
    <input type="date" id="billDate" name="billDate" readonly>

    <label>Receipt Number</label>
    <input type="text" id="receiptNo" name="receiptNo" readonly>

    <label>Class</label>
    <select id="classSelect" name="class" required onchange="loadStudents()">
      <option value="">Select Class</option>
    </select>

    <label>Student ID</label>
    <select id="studentName" name="studentName" required onchange="fillStudentId()">
      <option value="">Select Student</option>
    </select>

    <label>Student Name </label>
    <input type="text" id="studentId" name="studentId" readonly>

    <label>Fee Plan</label>
    <input type="text" name="feePlan">

    <label>Class Start Date</label>
    <input type="date" name="classStartDate">

    <label>Days Purchased</label>
    <input type="number" name="daysPurchased">

    <label>Total Fee</label>
    <input type="number" id="totalFee" name="totalFee" oninput="updateBalance()">

    <label>Paid Amount</label>
    <input type="number" id="paidAmount" name="paidAmount" oninput="updateBalance()">

    <label>Balance</label>
    <input type="number" id="balance" name="balance" readonly>

    <label>Payment Mode</label>
    <select name="paymentMode">
      <option value="Cash">Cash</option>
      <option value="UPI">UPI</option>
      <option value="Card">Card</option>
    </select>

    <label>Remarks</label>
    <textarea name="remarks"></textarea>

    <label>Payment Status</label>
    <select name="paymentStatus">
      <option value="Paid">Paid</option>
      <option value="Partially Paid">Partially Paid</option>
      <option value="Pending">Pending</option>
    </select>

    <div class="actions">
      <button type="button" onclick="saveBill()">Save Bill</button>
      <button type="button" onclick="location.href='dashboard.html'">Go to Dashboard</button>
    </div>
  </form>
</div>

<footer>Â© 2025 ALIF EDU. All rights reserved.</footer>

<script>
const FETCH_URL = "https://script.google.com/macros/s/AKfycbyhVD_GWLlE1JeMScnEKBSsWypN0_rUKvANrfqw_NUPfk9wuRoq5tEuViz-OwZO3DjBhQ/exec?action=getStudentData";
const SAVE_URL = "https://script.google.com/macros/s/AKfycbz933abjmypGrajkrRn3G42SvjRgucCWnuttzDOTcnU24yFpqlFT9V1PJ1OZ0U664Kw/exec";

let studentData = {};

window.onload = () => {
  document.getElementById("billDate").valueAsDate = new Date();

  fetch(FETCH_URL)
    .then(res => res.json())
    .then(data => {
      studentData = data;
      const classSelect = document.getElementById("classSelect");
      Object.keys(data).forEach(cls => {
        const opt = document.createElement("option");
        opt.value = cls;
        opt.textContent = cls;
        classSelect.appendChild(opt);
      });
    });
};

function loadStudents() {
  const cls = document.getElementById("classSelect").value;
  const studentName = document.getElementById("studentName");
  studentName.innerHTML = '<option value="">Select Student</option>';

  if (studentData[cls]) {
    studentData[cls].forEach(s => {
      const opt = document.createElement("option");
      opt.value = s.name;
      opt.textContent = s.name;
      opt.dataset.id = s.id;
      studentName.appendChild(opt);
    });
  }
  document.getElementById("studentId").value = '';
}

function fillStudentId() {
  const cls = document.getElementById("classSelect").value;
  const name = document.getElementById("studentName").value;
  const found = studentData[cls]?.find(s => s.name === name);
  document.getElementById("studentId").value = found ? found.id : '';
}

function updateBalance() {
  const total = parseFloat(document.getElementById("totalFee").value) || 0;
  const paid = parseFloat(document.getElementById("paidAmount").value) || 0;
  document.getElementById("balance").value = (total - paid).toFixed(2);
}

function saveBill() {
  const form = document.getElementById("billingForm");
  const formData = new FormData(form);
  const data = {};
  formData.forEach((v, k) => data[k] = v);

  fetch(SAVE_URL, {
    method: "POST",
    body: JSON.stringify(data),
    headers: { "Content-Type": "application/json" }
  }).then(res => res.json())
    .then(res => {
      alert("Saved successfully!");
      form.reset();
      document.getElementById("billDate").valueAsDate = new Date();
    }).catch(err => alert("Error saving: " + err));
}
</script>

</body>
</html>
